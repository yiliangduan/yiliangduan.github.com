<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Seite 3 | elang&#39;s notes</title>
  <meta name="author" content="elangduan@126.com">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="elang&#39;s notes"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="elang&#39;s notes" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">elang&#39;s notes</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2017-02-25T05:56:36.000Z"><a href="/2017/02/25/unity_monobehavior_awake_function_call_time/">2017-02-25</a></time>
      
      
  
    <h1 class="title"><a href="/2017/02/25/unity_monobehavior_awake_function_call_time/">MonoBehaviour的Awake的调用时机</a></h1>
  

    </header>
    <div class="entry">
      
        <p>对MonoBehaviour的Awake之前有一个一直错误的理解:如果一个GameObject被添加到scene中，就算Active为false只要场景运行，此GameObejct的Awake函数就会调用。此理解是看了<a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.Awake.html" target="_blank" rel="external">官方文档</a>自己得出的结论:</p>
<blockquote>
<p>Awake is called when the script instance is being loaded.</p>
</blockquote>
<p>昨天同事问到这个问题的时候才自己测试了一遍，才发现我的理解是错误的。测试发现Awake只有在Active为true的时候会被调用一次。此外在查找资料的时候发现了Unity论坛里面有人在讨论这个问题<a href="http://answers.unity3d.com/questions/942915/something-like-awake-that-runs-even-if-disabled.html" target="_blank" rel="external">Something like Awake that runs even if disabled?</a>。有答案说构造方法会在GameObject的Active为false的时候会被调用，测试了一下却是如此。</p>
<p>继续浏览了Monobehaviour的文档，发现文档里面也着重写了这个问题:</p>
<blockquote>
<p>Note: The checkbox for disabling a MonoBehavior (on the editor) will only prevent Start(), Awake(), Update(), FixedUpdate(), and OnGUI() from executing. If none of these functions are present, the checkbox is not displayed.</p>
</blockquote>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2017/02/25/unity_monobehavior_awake_function_call_time/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2017-02-11T09:03:34.000Z"><a href="/2017/02/11/json_auto_generate_cs_code/">2017-02-11</a></time>
      
      
  
    <h1 class="title"><a href="/2017/02/11/json_auto_generate_cs_code/">Json自动生成C#代码的工具</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>由于现在项目里面与服务器通信的数据使用的Json格式，在每次服务器添加协议的时候客户端都要根据服务器返回的数据对照写一遍解析的数据类和解析类，这样重复性的工作比较浪费时间，所以写了一个Json自动生成C#代码的工具，只要把服务器返回的Json数据用这个工具转换一下就可以自动生成对应的C#解析的代码。</p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2017/02/11/json_auto_generate_cs_code/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-28T15:39:00.000Z"><a href="/2016/12/28/unity_download_api_experient/">2016-12-28</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/28/unity_download_api_experient/">Unity 文件下载分析</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在项目里面有时需要从服务器上下载比较大的文件，比如我们在做更新的时候需要下载AssetBundle文件。Unity3D中提供了WWW接口可以用来下载文件，但是使用之后发现这个接口在下载比较大的文件的时候非常占用内存资源。然后我用C#的Webclient接口来下载同样的文件，发现内存占用情况存在和WWW的完全不一样。本文来就来探讨一下使用WWW和Webclient两个接口下载文件造成内存占用的原因。</p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2016/12/28/unity_download_api_experient/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-10-29T13:16:35.000Z"><a href="/2016/10/29/unity_mono_foreach_memory_bug/">2016-10-29</a></time>
      
      
  
    <h1 class="title"><a href="/2016/10/29/unity_mono_foreach_memory_bug/">C# foreach带来的内存问题</a></h1>
  

    </header>
    <div class="entry">
      
        <h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>在使用Unity工具开发游戏的时候经常会被建议不要使用foreach,究其原因说是会产生额外的heap内存,既然存在这种问题, 那我必须得自己搞清楚下。本文是自己查阅资料和试验的结果总结。</p>
<p>本文参考了<a href="https://stackoverflow.com/a/26110503" target="_blank" rel="external">Memory allocation when using foreach loops in C#</a></p>
<p><em>测试环境: Unity5.4.1f1, MonoV2.0.5</em></p>
<h4 id="剖析"><a href="#剖析" class="headerlink" title="剖析"></a>剖析</h4><p>首先来搞明白使用foreach和for的区别,下面是一个简单的例子:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Sample1.0</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;<span class="keyword">string</span>&gt; list = <span class="keyword">new</span> List&lt;<span class="keyword">string</span>&gt;()&#123;<span class="string">"hello"</span>, <span class="string">"world"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="keyword">string</span> item <span class="keyword">in</span> list)</span><br><span class="line">    &#123;</span><br><span class="line">        UnityEngine.Debug.Log(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2016/10/29/unity_mono_foreach_memory_bug/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-05T12:49:40.000Z"><a href="/2016/09/05/unity_in_app_purchase_note/">2016-09-05</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/05/unity_in_app_purchase_note/">Unity 苹果IAP和微信支付接入</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="苹果IAP接入"><a href="#苹果IAP接入" class="headerlink" title="苹果IAP接入"></a>苹果IAP接入</h3><p>相比微信支付和支付宝支付要麻烦一些,麻烦的地方主要体现在对测试支付环境的要求以及苹果审核方面的要求上面。本文是自己在接入iOS的IAP模块的经验及总结，发出来分享下。建议需要接入的话还是浏览一遍<a href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/StoreKitGuide/Introduction.html" target="_blank" rel="external">苹果官方文档</a></p>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ul>
<li>测试支付的ipa必须使用[App-Store]证书</li>
<li>越狱机器无法测试IAP</li>
<li>用SandBox账号测试支付的时候,必须把在系统<strong>[设置]</strong>里面把<strong>[Itunes Store 与 App Store]</strong>登录的非SandBox账号注销掉,否则向苹果服务器请求不到订单信息</li>
<li>Sandbox账号不要在正式支付环境登陆支付，登陆过的正式支付环境的SandBox账号会失效</li>
<li>所有在itunes上配置的商品都必须可购买,不能有某些商品根据商户自己的服务器的数据在某个时期出现免费的情况</li>
<li>商品列表不能按照某些特定条件进行排序(比如说下载量)</li>
<li>非消耗型商品必须的有恢复商品功能</li>
<li>非消耗类型的商品不要和商户自己的服务器关联</li>
</ul>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2016/09/05/unity_in_app_purchase_note/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-07-16T08:44:10.000Z"><a href="/2016/07/16/unity_assetbundle_learning_and_summary/">2016-07-16</a></time>
      
      
  
    <h1 class="title"><a href="/2016/07/16/unity_assetbundle_learning_and_summary/">Unity AssetBundle学习、分析及总结</a></h1>
  

    </header>
    <div class="entry">
      
        <p>本文是学习<a href="https://unity3d.com/learn/tutorials/topics/best-practices" target="_blank" rel="external">Unity官方教程</a>、<a href="https://docs.unity3d.com/ScriptReference/" target="_blank" rel="external">Unity官方的API</a>和阅读Unity代码的总结</p>
<h4 id="AssetBundle基本知识"><a href="#AssetBundle基本知识" class="headerlink" title="AssetBundle基本知识"></a>AssetBundle基本知识</h4><p><strong>1.</strong> AssetBundle由两部分组成:头部(header)数据部分(data segment)</p>
<ul>
<li><strong>头部</strong>保存了版本号、数据类型、<font color="#FF0000">文件信息</font>、是否压缩等这些描述信息。<ul>
<li>文件信息记录了数据部分里面的所有单个资源的文件名以及在整个AssetBundle中文件offset和size,通过这个信息可以直接获取到AssetBundle中的某一个文件的数据。从Unity5.3版本开始这部分数据会单独生成一个AssetBundle同名的.manifest文件。</li>
</ul>
</li>
<li><strong>数据块</strong>保存了在build AssetBundle时候标记的textures、prefabs、materials等这些资源文件</li>
</ul>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2016/07/16/unity_assetbundle_learning_and_summary/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-06-29T13:06:34.000Z"><a href="/2016/06/29/cs_object_refer_each_other/">2016-06-29</a></time>
      
      
  
    <h1 class="title"><a href="/2016/06/29/cs_object_refer_each_other/">C# 内存管理之对象循环引用问题</a></h1>
  

    </header>
    <div class="entry">
      
        <p><strong>C#的内存管理</strong>用到了引用计数， 但是和以往我们认识的Java、Objective-c的内存管理有非常大的不同之处。不同之处在于C#的引用计数只有在GC Root对象引用的对象身上才生效，也就是说如果一个对象被GC Root对象引用了，那么在这个GC Root对象没有销毁之前这个对象是不会被销毁的。反之，如果一个对象没有被GC Root对象引用，即便这个对象被再多非GC Root对象引用，也会再下一次内存回收的时候被销毁。</p>
<p>GC Roots:</p>
<ul>
<li>正在运行的局部变量</li>
<li>静态变量</li>
<li>重写了object的finalizer方法的变量</li>
<li>正在调用的函数传递的参数</li>
</ul>
<p>下图演示了几种对象引用的情况:</p>
<p><img src="/images/cs_object_reference_each_other/1.png" alt=""></p>
<p>根据我们前面的描述，我们很容易判断object A和object B在RootA 被释放之后随之会被释放，object C和object D 虽然循环引用，但是没有被Root引用，所以在下一次内存回收的时候就会被释放,RootB和RootC造成了循环引用所以释放不了。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-06-18T04:03:10.000Z"><a href="/2016/06/18/unity_resource_memory_summary/">2016-06-18</a></time>
      
      
  
    <h1 class="title"><a href="/2016/06/18/unity_resource_memory_summary/">Unity中内存资源释放总结</a></h1>
  

    </header>
    <div class="entry">
      
        <p><strong>Unity内存释放</strong> 问题主要考虑一下几个方面:<br>  (1)  Resources 加载的资源需要释放的时候调用 Resources.UnloadUnusedAssets();</p>
<p>  (2) WWW 加载的任何资源<font color="#FF0000">必须</font>调用WWW的Dispose接口</p>
<p>  (3) 创建的RenderTexture<font color="#FF0000">必须</font>调用Release接口</p>
<p>  (4) 必须用Xcode联机调试确定C++层有没有内存泄漏</p>
<p>  (5) AssetBundle资源在Unity Profile中的Scene Memory不会显示，可以通过Xcode联机调试确定有没有释放完全</p>
<p>  (6) 加载资源和卸载资源的异步处理,避免同一帧内加载过多资源导致内存瞬间增大从而导致Crash(低配机器上表现更明显)</p>
<p>一般通过WWW加载一张Texture来通过Image显示的话，一种的方法是使用Texture通过Sprite.Create来创建一个Sprite对象赋值给Image.overrideSprite完成显示。但是需要注意一个问题，Sprite.Create创建对象对拷贝Texture中数据，并生成一个新的Sprite对象，这样会造成耗费将近2倍Texture大小的内存，而且这个内存占用不会随着Image的销毁而马上销毁，知道你调用Resources.UnloadUnusedResources()接口才会销毁。如果在一个场景中有大量的图片需要动态加载的话，那么必须注意内存问题了。所以建议不要使用显示Image的方式，有一种方式是显示RawImage，按照官方文档的描述:</p>
<blockquote>
<p>The Raw Image control displays a non-interactive image to the user. This can be used for decoration, icons, etc, and the image can also be changed from a script to reflect changes in other controls.</p>
</blockquote>
<p>RawImage是一个没有和用户交互的Image，所以如果我们不需要比如事件这种交互的操作的话，还是建议用RawImage来显示Texture。RawImage的方式会高效很多，如果从AssetBundle里面加载了一张Texture，不管是赋值给多少个RawImage，Texture是公用的，只会有一分内存。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/page/2/" class="alignleft prev">Vorherige Seite</a>
  
  
    <a href="/page/4/" class="alignright next">Nächste Seite</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Suche">
    <input type="hidden" name="q" value="site:elangduan.github.com">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Unity-unity/">Unity, unity</a><small>1</small></li>
  
    <li><a href="/tags/c/">c</a><small>1</small></li>
  
    <li><a href="/tags/cplusplus/">cplusplus</a><small>1</small></li>
  
    <li><a href="/tags/csharp/">csharp</a><small>10</small></li>
  
    <li><a href="/tags/graphics/">graphics</a><small>1</small></li>
  
    <li><a href="/tags/opengl/">opengl</a><small>1</small></li>
  
    <li><a href="/tags/unity/">unity</a><small>14</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2018 elangduan@126.com
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
